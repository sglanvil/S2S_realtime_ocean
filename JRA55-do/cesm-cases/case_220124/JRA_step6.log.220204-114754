/glade/u/home/ssfcst/JRA55-do/cesm-scripts/JRA_step6.sh ENTER
#trap '[[ $BASH_COMMAND != echo* ]] && $BASH_COMMAND' DEBUG

# LID=$(date +%y%m%d-%H%M%S)
# LOGFILE=$(pwd)/master.$YEAR.log.$LID
#-------------------------------------------------------------------------------

DATADIR=/glade/campaign/cesm/development/cross-wg/S2S/JRA55_data # work dir for input, output, intermediate data
HOMEDIR=/glade/u/home/ssfcst/JRA55-do                # root dir for all JRA55-do scripts (repo root dir)
SCRIPTDIR=/glade/u/home/ssfcst/JRA55-do/cesm-scripts # where the CESM wrapper scripts are

# -------------------- user only needs to specify "DATE" --------------------
DATE=2022-01-24                 # form: YYYYY-MM-DD

# -------------------- note, start date must always be January 1 --------------------
YEARs=$(date +%Y -d "$DATE")    	# start date: year
MONTHs=1                        	# start date: month
DAYs=1                          	# start date: day of month
ODAYs=1                         	# start date: ordinal day (day of year)
YEARe=$(date +%Y -d "$DATE")    	# end date: year
MONTHe=$(date +%m -d "$DATE")   	# end date: month
DAYe=$(date +%d -d "$DATE")     	# end date: day of month
ODAYe=$(date +%j -d "$DATE")    	# end date: ordinal day (day of year)
YEARp=$(date +%Y -d "$DATE + 1 day")    # day after end date: year
MONTHp=$(date +%m -d "$DATE + 1 day")   # day after end date: month
DAYp=$(date +%d -d "$DATE + 1 day")     # day after end date: day of month
DATESTRe=$YEARe$MONTHe$DAYe     	# end date: text string for netCDF file name
DATESTRc=$YEARe$MONTHe$DAYe     	# file creation date text string for netCDF file name

COMPILE=FALSE   			# TRUE => compile code (usually set to FALSE)
DOWNLOAD=TRUE				# download ftp data (usually set to TRUE)
DO_STEP0=FALSE
DO_STEP1=TRUE 
DO_STEP2=TRUE
DO_STEP3=TRUE
DO_STEP4=TRUE
DO_STEP5=TRUE
DO_STEP6=TRUE
DO_STEP7=TRUE
DO_STEP8=TRUE 
LOGFILE=${CASEDIR}/${0}.${LID}
echo "$0 LOGFILE = $LOGFILE"
/glade/u/home/ssfcst/JRA55-do/cesm-scripts/JRA_step6.sh LOGFILE = /glade/u/home/ssfcst/JRA55-do/cesm-cases/case_220124//glade/u/home/ssfcst/JRA55-do/cesm-scripts/JRA_step6.sh.220204-114754
echo "$0 HOMEDIR = $LOGFILE"
/glade/u/home/ssfcst/JRA55-do/cesm-scripts/JRA_step6.sh HOMEDIR = /glade/u/home/ssfcst/JRA55-do/cesm-cases/case_220124//glade/u/home/ssfcst/JRA55-do/cesm-scripts/JRA_step6.sh.220204-114754
#-------------------------------------------------------------------------------

echo "==========================================================================="
===========================================================================
echo "6 Additional adjustment of surface atmospheric variables"
6 Additional adjustment of surface atmospheric variables
echo "==========================================================================="
===========================================================================

#-----------------------------------------------------------------------------------------
echo " Smoothing air temp and spec humidity in marginal sea-ice zones -----------"
 Smoothing air temp and spec humidity in marginal sea-ice zones -----------
echo "tStamp: $(date +%y%m%d-%H%M%S)"
tStamp: 220204-114754
#-----------------------------------------------------------------------------------------

cd $HOMEDIR/jra55_calib
pwd
/glade/u/home/ssfcst/JRA55-do/jra55_calib

if [ $COMPILE == "TRUE" ] ; then
   gmake calib_tmp10m_iceedge_mon_interannual
fi

LOGFILE=$CASEDIR/calib_tmp10m_iceedge_update_exec_v1_3.log.$LID
time ./calib_tmp10m_iceedge_update_exec_v1_3.sh  $YEARs $MONTHs $DAYs   $YEARp $MONTHp $DAYp  >& $LOGFILE

real	0m20.532s
user	0m13.578s
sys	0m0.598s
mv tmp10m_iceedge_update.log $CASEDIR/tmp10m_iceedge_update.log.$LID
#  input: .../linkdir/work/jra55fcst_v1_3_prod1_3hr_TL319
# output: .../linkdir/work/jra55fcst_v1_3_prod2_3hr_TL319


#-----------------------------------------------------------------------------------------
echo " Cutting off extremely low temperature around Antarctica ------------------"
 Cutting off extremely low temperature around Antarctica ------------------
echo "tStamp: $(date +%y%m%d-%H%M%S)"
tStamp: 220204-114814
#-----------------------------------------------------------------------------------------

cd $HOMEDIR/jra55_calib
pwd
/glade/u/home/ssfcst/JRA55-do/jra55_calib

if [ $COMPILE == "TRUE" ] ; then
   gmake calib_tmp10m_antarc_interannual
fi

LOGFILE=$CASEDIR/calib_tmp10m_antarc_update_exec_v1_3.log.$LID
time ./calib_tmp10m_antarc_update_exec_v1_3.sh  $YEARs $MONTHs $DAYs   $YEARp $MONTHp $DAYp  >& $LOGFILE

real	0m13.398s
user	0m9.950s
sys	0m0.499s
mv tmp10m_antarc_update.log  $CASEDIR/tmp10m_antarc_update.log.$LID
#  input: .../linkdir/work/jra55fcst_v1_3_prod2_3hr_TL319 (see above)
# output: .../linkdir/work/jra55fcst_v1_3_prod3_3hr_TL319

echo ${0} "EXIT"
/glade/u/home/ssfcst/JRA55-do/cesm-scripts/JRA_step6.sh EXIT
