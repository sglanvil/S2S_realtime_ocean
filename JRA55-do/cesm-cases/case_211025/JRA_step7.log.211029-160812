/glade/u/home/ssfcst/JRA55-do/cesm-scripts/JRA_step7.sh ENTER
#trap '[[ $BASH_COMMAND != echo* ]] && $BASH_COMMAND' DEBUG

# LID=$(date +%y%m%d-%H%M%S)
# LOGFILE=$(pwd)/master.$YEAR.log.$LID
#-------------------------------------------------------------------------------


DATADIR=/glade/campaign/cesm/development/cross-wg/S2S/JRA55_data # work dir for input, output, intermediate data
HOMEDIR=/glade/u/home/ssfcst/JRA55-do                # root dir for all JRA55-do scripts (repo root dir)
SCRIPTDIR=/glade/u/home/ssfcst/JRA55-do/cesm-scripts # where the CESM wrapper scripts are

YEARs=2021    # start date: year 
MONTHs=1      # start date: month 
DAYs=1        # start date: day of month
ODAYs=1       # start date: ordinal day (day in year)

YEARe=2021    # end date: year 
MONTHe=10      # end date: month of year
DAYe=25       # end date: day of month
ODAYe=298      # end date: ordinal day
DATESTRe=20211025 # end date: text string for netCDF file name

YEARp=2021    # end date: year 
MONTHp=10      # day after end date: month of year
DAYp=26       # day after end date: day of month

DATESTRc=20211025 # file creation date text string for netCDF file name

COMPILE=FALSE   # TRUE => compile code
DOWNLOAD=TRUE   # download ftp data

DO_STEP0=FALSE
DO_STEP1=TRUE
DO_STEP2=TRUE
DO_STEP3=TRUE
DO_STEP4=TRUE
DO_STEP5=TRUE
DO_STEP6=TRUE
DO_STEP7=TRUE
DO_STEP8=TRUE 
LOGFILE=${CASEDIR}/${0}.${LID}
echo "$0 LOGFILE = $LOGFILE"
/glade/u/home/ssfcst/JRA55-do/cesm-scripts/JRA_step7.sh LOGFILE = /glade/u/home/ssfcst/JRA55-do/cesm-cases/case_211025//glade/u/home/ssfcst/JRA55-do/cesm-scripts/JRA_step7.sh.211029-160812
echo "$0 HOMEDIR = $LOGFILE"
/glade/u/home/ssfcst/JRA55-do/cesm-scripts/JRA_step7.sh HOMEDIR = /glade/u/home/ssfcst/JRA55-do/cesm-cases/case_211025//glade/u/home/ssfcst/JRA55-do/cesm-scripts/JRA_step7.sh.211029-160812
#-------------------------------------------------------------------------------

echo "==========================================================================="
===========================================================================
echo "7 Applying globally constant factors to downward fluxes"
7 Applying globally constant factors to downward fluxes
echo "==========================================================================="
===========================================================================

#-----------------------------------------------------------------------------------------
echo " Downward Radiation -------------------------------------------------------"
 Downward Radiation -------------------------------------------------------
echo "tStamp: $(date +%y%m%d-%H%M%S)"
tStamp: 211029-160812
#-----------------------------------------------------------------------------------------

cd $HOMEDIR/jra55_calib
pwd
/glade/u/home/ssfcst/JRA55-do/jra55_calib

if [ $COMPILE == "TRUE" ] ; then
   gmake calib_rad_interannual
fi

LOGFILE=$CASEDIR/calib_rad_const_update_exec_v1_3.log.$LID
time ./calib_rad_const_update_exec.sh  v1_3 $YEARs $MONTHs $DAYs   $YEARp $MONTHp $DAYp  >& $LOGFILE

real	0m43.817s
user	0m4.607s
sys	0m2.259s
mv calib_rad_const_v1_3_update.log $CASEDIR/calib_rad_const_v1_3_update.log.$LID
#  input: .../linkdir/work/jra55fcst_v0_7_rad1_3hr_TL319
# output: .../linkdir/work/jra55fcst_v1_3_rad2_3hr_TL319

#-----------------------------------------------------------------------------------------
echo " Precipitation ------------------------------------------------------------"
 Precipitation ------------------------------------------------------------
echo "tStamp: $(date +%y%m%d-%H%M%S)"
tStamp: 211029-160856
#-----------------------------------------------------------------------------------------

cd $HOMEDIR/jra55_calib
pwd
/glade/u/home/ssfcst/JRA55-do/jra55_calib

if [ $COMPILE == "TRUE" ] ; then
   gmake calib_precip_interannual
fi

LOGFILE=$CASEDIR/calib_prcp_snow_const_update_exec_v1_3.log.$LID
time ./calib_prcp_snow_const_update_exec.sh  v1_3 $YEARs $MONTHs $DAYs   $YEARp $MONTHp $DAYp  >& $LOGFILE

real	0m40.231s
user	0m4.095s
sys	0m2.729s
mv calib_prcp_const_v1_3_update.log $CASEDIR/calib_prcp_const_v1_3_update.log.$LID
mv calib_snow_const_v1_3_update.log $CASEDIR/calib_snow_const_v1_3_update.log.$LID
#  input: .../linkdir/work/jra55fcst_v1_2_prcp_3hr_TL319
# output: .../linkdir/work/jra55fcst_v1_3_prcp2_3hr_TL319

#-----------------------------------------------------------------------------------------
echo " Generate rain data -------------------------------------------------------"
 Generate rain data -------------------------------------------------------
echo "tStamp: $(date +%y%m%d-%H%M%S)"
tStamp: 211029-160936
#-----------------------------------------------------------------------------------------
# CREATES  .../linkdir/products/version_1_5/grads/YYYY  FOR WHOLE YEAR

cd $HOMEDIR/jra55_calib
pwd
/glade/u/home/ssfcst/JRA55-do/jra55_calib

if [ $COMPILE == "TRUE" ] ; then
   gmake precip_minus_snow_interannual
fi

DIR=$HOMEDIR/linkdir/products/version_1_5/grads/$YEARs ; if [ ! -d $DIR ]; then mkdir -p $DIR ; fi

LOGFILE=$CASEDIR/create_rain_update_log.$LID
time ./create_rain_update.sh v1_5 $YEARs $MONTHs $DAYs   $YEARp $MONTHp $DAYp  >& $LOGFILE

real	0m8.571s
user	0m2.040s
sys	0m1.498s
mv create_rain-v1_5_update.log $CASEDIR/create_rain-v1_5_update.log.$LID
#  input: .../linkdir/work/jra55fcst_v1_3_prcp2_3hr_TL319
# output: .../linkdir/work/version_1_5/grads/YYYY 

echo ${0} "EXIT"
/glade/u/home/ssfcst/JRA55-do/cesm-scripts/JRA_step7.sh EXIT
