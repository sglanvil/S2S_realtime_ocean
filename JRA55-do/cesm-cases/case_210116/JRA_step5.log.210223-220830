/glade/u/home/ssfcst/JRA55-do/cesm-scripts/JRA_step5.sh ENTER
#trap '[[ $BASH_COMMAND != echo* ]] && $BASH_COMMAND' DEBUG
#-------------------------------------------------------------------------------
# LID=$(date +%y%m%d-%H%M%S)
# LOGFILE=$(pwd)/master.$YEAR.log.$LID

#BK: not sure why I can't add to $PATH and have it find wgrib
alias wgrib=/glade/u/home/ssfcst/local/bin/wgrib

DATADIR=/glade/campaign/cesm/development/cross-wg/S2S/JRA55_data # where input, output, intermediate data is
HOMEDIR=/glade/u/home/ssfcst//JRA55-do               # where the standard JRA55-do scripts are
SCRIPTDIR=/glade/u/home/ssfcst/JRA55-do/cesm-scripts # where the CESM wrapper scripts are

YEARs=2021    # start date: year 
MONTHs=1      # start date: month 
DAYs=1        # start date: day in month
ODAYs=1       # start date: ordinal day (day in year)

YEARe=2021    # end date: year -- ?  assume YEARs = YEARe
MONTHe=1      # end date: month 
DAYe=16       # end date: day in month
ODAYe=16      # end date: ordinal day
DATESTRe=2021-01-16 # end date: text string for netCDF file name

YEARp=2021    # end date: year -- ?  assume YEARs = YEARp
MONTHp=1      # day after end date: month
DAYp=17       # day after end date: day
ODAYp=17      # day after end date: ordinal day

DATESTRc=20210223 # file creation date text string for netCDF file name

COMPILE=FALSE   # TRUE => compile code
DOWNLOAD=TRUE   # download ftp data

DO_STEP0=FALSE
DO_STEP1=TRUE
DO_STEP2=TRUE
DO_STEP3=TRUE
DO_STEP4=TRUE
DO_STEP5=TRUE
DO_STEP6=TRUE
DO_STEP7=TRUE
DO_STEP8=TRUE 
LOGFILE=${CASEDIR}/${0}.${LID}
echo "$0 LOGFILE = $LOGFILE"
/glade/u/home/ssfcst/JRA55-do/cesm-scripts/JRA_step5.sh LOGFILE = /glade/u/home/ssfcst/JRA55-do/cesm-cases/case_210116//glade/u/home/ssfcst/JRA55-do/cesm-scripts/JRA_step5.sh.210223-220830
echo "$0 HOMEDIR = $LOGFILE"
/glade/u/home/ssfcst/JRA55-do/cesm-scripts/JRA_step5.sh HOMEDIR = /glade/u/home/ssfcst/JRA55-do/cesm-cases/case_210116//glade/u/home/ssfcst/JRA55-do/cesm-scripts/JRA_step5.sh.210223-220830
#-------------------------------------------------------------------------------

echo "==========================================================================="
===========================================================================
echo "5. Adjustment of precipitation fluxes"
5. Adjustment of precipitation fluxes
echo "==========================================================================="
===========================================================================

#-----------------------------------------------------------------------------------------
echo " Adjustment ---------------------------------------------------------------"
 Adjustment ---------------------------------------------------------------
echo "tStamp: $(date +%y%m%d-%H%M%S)"
tStamp: 210223-220830
#-----------------------------------------------------------------------------------------

cd $HOMEDIR/jra55_org_grid_calib
pwd
/glade/u/home/ssfcst/JRA55-do/jra55_org_grid_calib

if [ $COMPILE == "TRUE" ] ; then
   gmake calib_precip_interannual
fi

LOGFILE=$CASEDIR/calib_prcp_snow_interannual_update_exec_v1_2.log.$LID
time ./calib_prcp_snow_interannual_update_exec_v1_2.sh   $YEARs $MONTHs $DAYs   $YEARp $MONTHp $DAYp  >& $LOGFILE

real	0m2.487s
user	0m0.107s
sys	0m0.147s
mv calib_v1_2_prcp_update.log $CASEDIR
mv calib_v1_2_snow_update.log $CASEDIR
#  input: DATADIR/ ???
# output: .../linkdir/work/jra55fcst_v1_2_prcp_3hr_TL319r


#-----------------------------------------------------------------------------------------
echo " Map variables from reduced TL319 grid to normal TL319 grid -------"
 Map variables from reduced TL319 grid to normal TL319 grid -------
echo "tStamp: $(date +%y%m%d-%H%M%S)"
tStamp: 210223-220833
#-----------------------------------------------------------------------------------------

cd $HOMEDIR/jra55_org_grid_product   
pwd
/glade/u/home/ssfcst/JRA55-do/jra55_org_grid_product

if [ $COMPILE == "TRUE" ] ; then
   gmake make_red2reg
fi

LOGFILE=$CASEDIR/red2reg_exec_precip_v1_2.log.$LID
time ./red2reg_exec_precip_v1_2.sh   $YEARs $YEARe $ODAYs $ODAYe  >& $LOGFILE

real	0m5.773s
user	0m2.273s
sys	0m2.546s
#  input: .../linkdir/work/jra55fcst_v1_2_prcp_3hr_TL319r (see above)
# output: .../linkdir/work/jra55fcst_v1_2_prcp_3hr_TL319

echo ${0} "EXIT"
/glade/u/home/ssfcst/JRA55-do/cesm-scripts/JRA_step5.sh EXIT
