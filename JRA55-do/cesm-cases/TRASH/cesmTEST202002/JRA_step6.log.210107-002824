/glade/u/home/ssfcst/JRA55-do/cesm-scripts/JRA_step6.sh ENTER
#trap '[[ $BASH_COMMAND != echo* ]] && $BASH_COMMAND' DEBUG
#-------------------------------------------------------------------------------
# LID=$(date +%y%m%d-%H%M%S)
# LOGFILE=$(pwd)/master.$YEAR.log.$LID


DATADIR=/glade/scratch/ssfcst/JRA55_data             # where input, output, & intermediate data is here
HOMEDIR=/glade/u/home/ssfcst//JRA55-do               # where the standard JRA55-do scripts are
SCRIPTDIR=/glade/u/home/ssfcst/JRA55-do/cesm-scripts # where the CESM wrapper scripts are

YEARs=2020    # start date: year 
MONTHs=1      # start date: month 
DAYs=1        # start date: day in month
ODAYs=1       # start date: ordinal day (day in year)

YEARe=2020    # end date: year -- ?  assume YEARs = YEARe
MONTHe=2      # end date: month 
DAYe=29       # end date: day in month
ODAYe=60      # end date: ordinal day
DATESTRe=2020-02-29 # end date: text string for netCDF file name

DATESTRc=20210106 # end date: text string for netCDF file name

YEARp=2020    # end date: year -- ?  assume YEARs = YEARp
MONTHp=3      # day after end date: month
DAYp=1        # day after end date: day
ODAYp=61      # day after end date: ordinal day

COMPILE=TRUE    # TRUE => compile code
DOWNLOAD=TRUE   # download ftp data

DO_STEP0=FALSE
DO_STEP1=FALSE
DO_STEP2=FALSE
DO_STEP3=FALSE
DO_STEP4=FALSE
DO_STEP5=FALSE
DO_STEP6=TRUE 
DO_STEP7=FALSE
DO_STEP8=FALSE
LOGFILE=${CASEDIR}/${0}.${LID}
echo "$0 LOGFILE = $LOGFILE"
/glade/u/home/ssfcst/JRA55-do/cesm-scripts/JRA_step6.sh LOGFILE = /glade/u/home/ssfcst/JRA55-do/cesmTEST202002//glade/u/home/ssfcst/JRA55-do/cesm-scripts/JRA_step6.sh.210107-002824
echo "$0 HOMEDIR = $LOGFILE"
/glade/u/home/ssfcst/JRA55-do/cesm-scripts/JRA_step6.sh HOMEDIR = /glade/u/home/ssfcst/JRA55-do/cesmTEST202002//glade/u/home/ssfcst/JRA55-do/cesm-scripts/JRA_step6.sh.210107-002824
#-------------------------------------------------------------------------------

echo "==========================================================================="
===========================================================================
echo "6 Additional adjustment of surface atmospheric variables"
6 Additional adjustment of surface atmospheric variables
echo "==========================================================================="
===========================================================================

#-----------------------------------------------------------------------------------------
echo " Smoothing air temp and spec humidity in marginal sea-ice zones -----------"
 Smoothing air temp and spec humidity in marginal sea-ice zones -----------
echo "tStamp: $(date +%y%m%d-%H%M%S)"
tStamp: 210107-002824
#-----------------------------------------------------------------------------------------

cd $HOMEDIR/jra55_calib
pwd
/glade/u/home/ssfcst/JRA55-do/jra55_calib

if [ $COMPILE == "TRUE" ] ; then
   gmake calib_tmp10m_iceedge_mon_interannual
fi
ifort -c -convert big_endian -assume byterecl  -I ../lib -o fileunmng.o src/file_mng/fileunmng.F90
ifort -c -convert big_endian -assume byterecl  -I ../lib -o fileocmng.o src/file_mng/fileocmng.F90
ifort -c -convert big_endian -assume byterecl  -I ../lib -o force_process.o src/force_process.F90
ifort -c -convert big_endian -assume byterecl  -I ../lib -o hintpl.o src/hintpl.F90
ar rv lib.a fileunmng.o fileocmng.o force_process.o hintpl.o
ar: creating lib.a
a - fileunmng.o
a - fileocmng.o
a - force_process.o
a - hintpl.o
ifort src/calib_tmp10m_iceedge_mon_interannual.F90 -c -convert big_endian -assume byterecl -I ../lib  -o calib_tmp10m_iceedge_mon_interannual.o
ifort calib_tmp10m_iceedge_mon_interannual.o lib.a  -L ../lib -lmxe -o calib_tmp10m_iceedge_mon_interannual
rm calib_tmp10m_iceedge_mon_interannual.o

LOGFILE=$CASEDIR/calib_tmp10m_iceedge_update_exec_v1_3.log.$LID
time ./calib_tmp10m_iceedge_update_exec_v1_3.sh  $YEARs $MONTHs $DAYs   $YEARp $MONTHp $DAYp  >& $LOGFILE

real	1m18.348s
user	0m31.294s
sys	0m1.177s
mv tmp10m_iceedge_update.log $CASEDIR/tmp10m_iceedge_update.log.$LID
#  input: .../linkdir/work/jra55fcst_v1_3_prod1_3hr_TL319
# output: .../linkdir/work/jra55fcst_v1_3_prod2_3hr_TL319


#-----------------------------------------------------------------------------------------
echo " Cutting off extremely low temperature around Antarctica ------------------"
 Cutting off extremely low temperature around Antarctica ------------------
echo "tStamp: $(date +%y%m%d-%H%M%S)"
tStamp: 210107-002946
#-----------------------------------------------------------------------------------------

cd $HOMEDIR/jra55_calib
pwd
/glade/u/home/ssfcst/JRA55-do/jra55_calib

if [ $COMPILE == "TRUE" ] ; then
   gmake calib_tmp10m_antarc_interannual
fi
ifort src/calib_tmp10m_antarc_interannual.F90 -c -convert big_endian -assume byterecl -I ../lib  -o calib_tmp10m_antarc_interannual.o
ifort calib_tmp10m_antarc_interannual.o lib.a  -L ../lib -lmxe -o calib_tmp10m_antarc_interannual
rm calib_tmp10m_antarc_interannual.o

LOGFILE=$CASEDIR/calib_tmp10m_antarc_update_exec_v1_3.log.$LID
time ./calib_tmp10m_antarc_update_exec_v1_3.sh  $YEARs $MONTHs $DAYs   $YEARp $MONTHp $DAYp  >& $LOGFILE

real	1m4.796s
user	0m22.895s
sys	0m1.170s
mv tmp10m_antarc_update.log  $CASEDIR/tmp10m_antarc_update.log.$LID
#  input: .../linkdir/work/jra55fcst_v1_3_prod2_3hr_TL319 (see above)
# output: .../linkdir/work/jra55fcst_v1_3_prod3_3hr_TL319

echo ${0} "EXIT"
/glade/u/home/ssfcst/JRA55-do/cesm-scripts/JRA_step6.sh EXIT
