/glade/u/home/ssfcst/JRA55-do/cesm-scripts/JRA_step3.sh ENTER
#trap '[[ $BASH_COMMAND != echo* ]] && $BASH_COMMAND' DEBUG
#-------------------------------------------------------------------------------
# LID=$(date +%y%m%d-%H%M%S)
# LOGFILE=$(pwd)/master.$YEAR.log.$LID


DATADIR=/glade/scratch/ssfcst/JRA55_data             # where input, output, & intermediate data is here
HOMEDIR=/glade/u/home/ssfcst//JRA55-do               # where the standard JRA55-do scripts are
SCRIPTDIR=/glade/u/home/ssfcst/JRA55-do/cesm-scripts # where the CESM wrapper scripts are

YEARs=2020    # start date: year 
MONTHs=1      # start date: month 
DAYs=1        # start date: day in month
ODAYs=1       # start date: ordinal day (day in year)

YEARe=2020    # end date: year -- ?  assume YEARs = YEARe
MONTHe=12     # end date: month 
DAYe=31       # end date: day in month
ODAYe=366     # end date: ordinal day
DATESTRe=2020-12-31 # end date: text string for netCDF file name

DATESTRc=20210107 # creation date: text string for netCDF file name

YEARp=2021    # end date: year -- ?  assume YEARs = YEARp
MONTHp=1      # day after end date: month
DAYp=1        # day after end date: day
ODAYp=1       # day after end date: ordinal day

COMPILE=FALSE   # TRUE => compile code
DOWNLOAD=FALSE  # download ftp data

DO_STEP0=FALSE
DO_STEP1=TRUE
DO_STEP2=TRUE
DO_STEP3=TRUE
DO_STEP4=TRUE
DO_STEP5=TRUE
DO_STEP6=TRUE
DO_STEP7=TRUE
DO_STEP8=TRUE 
LOGFILE=${CASEDIR}/${0}.${LID}
echo "$0 LOGFILE = $LOGFILE"
/glade/u/home/ssfcst/JRA55-do/cesm-scripts/JRA_step3.sh LOGFILE = /glade/u/home/ssfcst/JRA55-do/cesm-cases/case_202012//glade/u/home/ssfcst/JRA55-do/cesm-scripts/JRA_step3.sh.210107-035413
echo "$0 HOMEDIR = $LOGFILE"
/glade/u/home/ssfcst/JRA55-do/cesm-scripts/JRA_step3.sh HOMEDIR = /glade/u/home/ssfcst/JRA55-do/cesm-cases/case_202012//glade/u/home/ssfcst/JRA55-do/cesm-scripts/JRA_step3.sh.210107-035413
#-------------------------------------------------------------------------------

echo "==========================================================================="
===========================================================================
echo "3. Adjustment of surface atmospheric variables"
3. Adjustment of surface atmospheric variables
echo "==========================================================================="
===========================================================================

#-----------------------------------------------------------------------------------------
echo " Air temperature ----------------------------------------------------------"
 Air temperature ----------------------------------------------------------
echo "tStamp: $(date +%y%m%d-%H%M%S)"
tStamp: 210107-035413
#-----------------------------------------------------------------------------------------

cd $HOMEDIR/jra55_org_grid_calib
pwd
/glade/u/home/ssfcst/JRA55-do/jra55_org_grid_calib

if [ $COMPILE == "TRUE" ] ; then
   gmake calib_tmp2m_interannual
fi

LOGFILE=$CASEDIR/calib_tmp2m_v1_2_interannual_latest_exec.log.$LID
time ./calib_tmp2m_v1_2_interannual_latest_exec.sh $YEARs $MONTHs $DAYs   $YEARp $MONTHp $DAYp  >& $LOGFILE

real	5m46.429s
user	0m17.750s
sys	0m5.852s
mv calib_v1_2_tmp2m_latest.log $CASEDIR/calib_v1_2_tmp2m_latest.log.$LID
#  input: DATADIR/ ???
# output: .../linkdir/work/jra55fcst_v1_2_3hr_tmp2m_TL319r/<yyyymm>/

#-----------------------------------------------------------------------------------------
echo " Specific humidity --------------------------------------------------------"
 Specific humidity --------------------------------------------------------
echo "tStamp: $(date +%y%m%d-%H%M%S)"
tStamp: 210107-040000
#-----------------------------------------------------------------------------------------

cd $HOMEDIR/jra55_org_grid_calib
pwd
/glade/u/home/ssfcst/JRA55-do/jra55_org_grid_calib

if [ $COMPILE == "TRUE" ] ; then
   gmake calib_sph2m_interannual
fi


LOGFILE=$CASEDIR/calib_sph2m_v1_2_interannual_latest_exec.log.$LID
time ./calib_sph2m_v1_2_interannual_latest_exec.sh $YEARs $MONTHs $DAYs  $YEARp $MONTHp $DAYp  >& $LOGFILE

real	1m7.474s
user	0m2.127s
sys	0m1.704s
mv calib_v1_2_sph2m_latest.log $CASEDIR/calib_v1_2_sph2m_latest.log.$LID
#  input: DATADIR/ ???
# output: .../linkdir/work/jra55fcst_v1_2_3hr_sph2m_TL319r/<yyyymm>/

#-----------------------------------------------------------------------------------------
echo " Compute equivalent neutral wind ------------------------------------------"
 Compute equivalent neutral wind ------------------------------------------
echo "tStamp: $(date +%y%m%d-%H%M%S)"
tStamp: 210107-040107
#-----------------------------------------------------------------------------------------

cd $HOMEDIR/jra55_org_grid_anl   
pwd
/glade/u/home/ssfcst/JRA55-do/jra55_org_grid_anl

if [ $COMPILE == "TRUE" ] ; then
   gmake diag_neutral_wind
fi

LOGFILE=$CASEDIR/jra55fcst_filt_v1_2tq_neutral_wind_exec.log.$LID
time ./jra55fcst_filt_v1_2tq_neutral_wind_exec.sh $YEARs $YEARe $ODAYs $ODAYe  >& $LOGFILE
