/glade/u/home/ssfcst/JRA55-do/cesm-scripts/JRA_step2.sh ENTER
#trap '[[ $BASH_COMMAND != echo* ]] && $BASH_COMMAND' DEBUG
#-------------------------------------------------------------------------------
# LID=$(date +%y%m%d-%H%M%S)
# LOGFILE=$(pwd)/master.$YEAR.log.$LID


DATADIR=/glade/scratch/ssfcst/JRA55_data             # where input, output, & intermediate data is here
HOMEDIR=/glade/u/home/ssfcst//JRA55-do               # where the standard JRA55-do scripts are
SCRIPTDIR=/glade/u/home/ssfcst/JRA55-do/cesm-scripts # where the CESM wrapper scripts are

YEARs=2020    # start date: year 
MONTHs=1      # start date: month 
DAYs=1        # start date: day in month
ODAYs=1       # start date: ordinal day (day in year)

YEARe=2020    # end date: year -- ?  assume YEARs = YEARe
MONTHe=12     # end date: month 
DAYe=31       # end date: day in month
ODAYe=366     # end date: ordinal day
DATESTRe=2020-12-31 # end date: text string for netCDF file name

DATESTRc=20210107 # creation date: text string for netCDF file name

YEARp=2021    # end date: year -- ?  assume YEARs = YEARp
MONTHp=1      # day after end date: month
DAYp=1        # day after end date: day
ODAYp=1       # day after end date: ordinal day

COMPILE=FALSE   # TRUE => compile code
DOWNLOAD=FALSE  # download ftp data

DO_STEP0=FALSE
DO_STEP1=TRUE
DO_STEP2=TRUE
DO_STEP3=TRUE
DO_STEP4=TRUE
DO_STEP5=TRUE
DO_STEP6=TRUE
DO_STEP7=TRUE
DO_STEP8=TRUE 
LOGFILE=${CASEDIR}/${0}.${LID}
echo "$0 LOGFILE = $LOGFILE"
/glade/u/home/ssfcst/JRA55-do/cesm-scripts/JRA_step2.sh LOGFILE = /glade/u/home/ssfcst/JRA55-do/cesm-cases/case_202012//glade/u/home/ssfcst/JRA55-do/cesm-scripts/JRA_step2.sh.210107-171029
echo "$0 HOMEDIR = $LOGFILE"
/glade/u/home/ssfcst/JRA55-do/cesm-scripts/JRA_step2.sh HOMEDIR = /glade/u/home/ssfcst/JRA55-do/cesm-cases/case_202012//glade/u/home/ssfcst/JRA55-do/cesm-scripts/JRA_step2.sh.210107-171029
#-------------------------------------------------------------------------------

echo "==========================================================================="
===========================================================================
echo "2. Update COBE SST data"
2. Update COBE SST data
echo "==========================================================================="
===========================================================================

#-----------------------------------------------------------------------------------------
echo " Download COBE-SST data ---------------------------------------------------"
 Download COBE-SST data ---------------------------------------------------
#-----------------------------------------------------------------------------------------

if [ $DOWNLOAD != "TRUE" ] ; then
   echo "No data downloading."
else
   cd $DATADIR/COBESST/daily/grib 
   pwd
   wget --no-check-certificate https://climate.mri-jma.go.jp/~htsujino/userspace/JRA55-do/repos/cobesst_daily/sst-glb.2019.dat
   wget --no-check-certificate https://climate.mri-jma.go.jp/~htsujino/userspace/JRA55-do/repos/cobesst_daily/sst-glb.2020.dat
   wget --no-check-certificate https://climate.mri-jma.go.jp/~htsujino/userspace/JRA55-do/repos/cobesst_daily/sst-glb.2021.dat
#  ?? don't need monthly data ??
   cd $DATADIR/COBESST/monthly/grib 
   pwd
   wget --no-check-certificate https://climate.mri-jma.go.jp/~htsujino/userspace/JRA55-do/repos/cobesst_monthly/sst-glb.2020.dat
fi
No data downloading.

#-----------------------------------------------------------------------------------------
echo " Decode GRIB and make flat binary -----------------------------------------"
 Decode GRIB and make flat binary -----------------------------------------
echo "tStamp: $(date +%y%m%d-%H%M%S)"
tStamp: 210107-171029
#-----------------------------------------------------------------------------------------

cd $HOMEDIR/cobesst
pwd
/glade/u/home/ssfcst/JRA55-do/cobesst

LOGFILE=$CASEDIR/grib2grads_cobesst_daily.log.$YEARe.$LID
time ./grib2grads_cobesst_daily.sh 2019   2021    >& $LOGFILE # HACK: need adjacent year's data (Dec 31, or Jan 1)

real	0m2.250s
user	0m1.087s
sys	0m0.434s
#ime ./grib2grads_cobesst_daily.sh $YEARs $YEARe  >& $LOGFILE
#  input: DATADIR/cobesst/daily/grib
# output: DATADIR/cobesst/daily/grads

LOGFILE=$CASEDIR/grib2grads_cobesst_monthly.log.$YEARe.$LID
time ./grib2grads_cobesst_monthly.sh $YEARs $YEARe  >& $LOGFILE

real	0m0.072s
user	0m0.019s
sys	0m0.033s
#  input: DATADIR/cobesst/monthly/grib
# output: DATADIR/cobesst/monthly/grads

if [ $COMPILE == "TRUE" ] ; then
   gmake separate_cobesst_monthly
fi

LOGFILE=$CASEDIR/make_sepmondata.log.$YEARe.$LID
time ./make_sepmondata.sh $YEARs $YEARe $MONTHe  >& $LOGFILE

real	0m0.404s
user	0m0.013s
sys	0m0.017s
#  input: DATADIR/cobesst/monthly/grads
# output: DATADIR/cobesst/monthly/yyyymm

#-----------------------------------------------------------------------------------------
echo " Create netCDF files used by input4MIPS -----------------------------------"
 Create netCDF files used by input4MIPS -----------------------------------
echo "tStamp: $(date +%y%m%d-%H%M%S)"
tStamp: 210107-171032
#-----------------------------------------------------------------------------------------

cd $HOMEDIR/anl/grd2nc_g_input4mips
pwd
/glade/u/home/ssfcst/JRA55-do/anl/grd2nc_g_input4mips

if [ $COMPILE == "TRUE" ] ; then
   gmake grd2nc_g
   gmake grd2nc_g_all
fi

cd $HOMEDIR/for_omip
pwd
/glade/u/home/ssfcst/JRA55-do/for_omip

LOGFILE=$CASEDIR/create_netcdf_cobesst.log.$YEARs.$LID
time ./create_netcdf_cobesst.sh $YEARs $YEARe $DATESTRe  $ODAYe  >& $LOGFILE

real	3m5.570s
user	0m0.915s
sys	0m28.565s
#  input: DATADIR/cobesst/monthly/grads
# output: DATADIR/products/support/netCDF


echo ${0} "EXIT"
/glade/u/home/ssfcst/JRA55-do/cesm-scripts/JRA_step2.sh EXIT
